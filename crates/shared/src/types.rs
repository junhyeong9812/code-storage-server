// =============================================================================
// 공통 타입 (types.rs)
// =============================================================================
//
// 모든 크레이트에서 사용하는 기본 타입들
// 타입 별칭(alias)과 헬퍼 함수 제공
//
// 파일 위치: crates/shared/src/types.rs
//
// 사용 예시:
//   use shared::types::{Id, Timestamp, new_id, now};
//
//   let user_id: Id = new_id();
//   let created_at: Timestamp = now();
// =============================================================================

// -----------------------------------------------------------------------------
// 외부 크레이트 import
// -----------------------------------------------------------------------------
use chrono::{DateTime, Utc};  // 날짜/시간 타입
use uuid::Uuid;                // UUID 타입

// =============================================================================
// 타입 별칭 (Type Alias)
// =============================================================================
//
// type A = B; 는 "A는 B의 다른 이름"이라는 의미
//
// 왜 타입 별칭을 쓰나요?
// 1. 가독성: Uuid보다 Id가 의미가 명확
// 2. 유연성: 나중에 Id 구현을 바꿔도 사용하는 코드 변경 최소화
// 3. 일관성: 프로젝트 전체에서 같은 이름 사용
//
// 주의: 타입 별칭은 새로운 타입을 만드는 게 아님!
// Id와 Uuid는 완전히 같은 타입으로 취급됨
// 진짜 새 타입을 만들려면 newtype 패턴 사용 (struct Id(Uuid);)

/// 공통 ID 타입
///
/// 모든 엔티티의 식별자로 UUID 사용
/// - RepositoryId, UserId, CommitId 등의 내부 타입
/// - 128비트, 충돌 확률 극히 낮음
/// - 분산 시스템에서 안전하게 생성 가능
///
/// # Example
/// ```
/// let id: Id = new_id();
/// println!("{}", id);  // "550e8400-e29b-41d4-a716-446655440000"
/// ```
pub type Id = Uuid;

/// 타임스탬프 타입
///
/// 생성일시, 수정일시 등에 사용
/// - DateTime<Utc>: UTC 시간대의 날짜/시간
/// - 시간대 정보 포함 → 글로벌 서비스에 적합
///
/// # Example
/// ```
/// let timestamp: Timestamp = now();
/// println!("{}", timestamp);  // "2024-01-15T10:30:00Z"
/// ```
pub type Timestamp = DateTime<Utc>;

// =============================================================================
// 헬퍼 함수
// =============================================================================

/// 새로운 고유 ID 생성
///
/// UUID v4 (랜덤 기반) 생성
/// - 122비트 랜덤
/// - 충돌 확률: 10억 개 생성해도 50% 충돌 확률 도달 안 함
///
/// # Returns
/// 새로운 UUID
///
/// # Example
/// ```
/// use shared::types::new_id;
///
/// let id = new_id();
/// println!("{}", id);  // "550e8400-e29b-41d4-a716-446655440000" 형태
/// ```
///
/// # 언제 사용하나요?
/// - 새 엔티티 생성 시
/// - Repository::new(), User::new() 등에서 호출
pub fn new_id() -> Id {
    Uuid::new_v4()  // v4: 랜덤 기반 UUID
}

/// 현재 시간 반환 (UTC)
///
/// 서버 시간이 아닌 UTC 기준 시간 반환
/// - 시간대에 독립적
/// - 전 세계 어디서든 같은 시간
///
/// # Returns
/// 현재 UTC 시간
///
/// # Example
/// ```
/// use shared::types::now;
///
/// let timestamp = now();
/// println!("{}", timestamp);  // "2024-01-15T10:30:00.123456Z"
/// println!("{}", timestamp.to_rfc3339());  // ISO 8601 형식
/// ```
///
/// # 언제 사용하나요?
/// - 엔티티의 created_at, updated_at 설정
/// - 로그 타임스탬프
pub fn now() -> Timestamp {
    Utc::now()
}

// =============================================================================
// 추가 유틸리티 (필요 시 구현)
// =============================================================================
//
// /// ID 문자열 파싱
// pub fn parse_id(s: &str) -> Result<Id, AppError> {
//     Uuid::parse_str(s)
//         .map_err(|_| AppError::InvalidInput(format!("Invalid ID: {}", s)))
// }
//
// /// 특정 시간으로 Timestamp 생성
// pub fn timestamp_from_str(s: &str) -> Result<Timestamp, AppError> {
//     DateTime::parse_from_rfc3339(s)
//         .map(|dt| dt.with_timezone(&Utc))
//         .map_err(|_| AppError::InvalidInput(format!("Invalid timestamp: {}", s)))
// }